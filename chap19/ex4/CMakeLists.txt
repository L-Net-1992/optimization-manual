check_cxx_compiler_flag(-mavx512fp16 COMPILER_SUPPORTS_FP16)
if(CMAKE_CXX_COMPILER_ID MATCHES Clang OR CMAKE_CXX_COMPILER_ID MATCHES GNU OR CMAKE_CXX_COMPILER_ID MATCHES AppleClang)
    if(COMPILER_SUPPORTS_FP16)
        set(fp16_ex4_srcs compress_ph.cpp)
        set_property(SOURCE ex4_test.cpp APPEND PROPERTY COMPILE_OPTIONS "-DCOMPILER_SUPPORTS_FP16")
        set_property(SOURCE compress_ph.cpp APPEND PROPERTY COMPILE_OPTIONS "-mavx512f" "-mavx512vbmi2" "-mavx512fp16" "-mavx512bw")
    endif()
else()
    set(fp16_ex4_srcs compress_ph.cpp)
    set_property(SOURCE ex4_test.cpp APPEND PROPERTY COMPILE_OPTIONS "/DCOMPILER_SUPPORTS_FP16")
endif()
add_executable(fp16_ex4_tests ex4_test.cpp ${fp16_ex4_srcs})
target_link_libraries(fp16_ex4_tests gtest_main optimisation_common)

add_test(NAME fp16_ex4_test COMMAND fp16_ex4_tests)
